<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Redis · Monix Connect</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="## Introduction"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Redis · Monix Connect"/><meta property="og:type" content="website"/><meta property="og:url" content="https://connect.monix.io/"/><meta property="og:description" content="## Introduction"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://connect.monix.io/img/monix-logo.png"/><link rel="shortcut icon" href="/img/monix-logo.png"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css"/><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/monix-logo.svg" alt="Monix Connect"/><h2 class="headerTitleWithLogo">Monix Connect</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/api/monix/connect/index.html" target="_self">API Docs</a></li><li class="siteNavGroupActive"><a href="/docs/overview" target="_self">Documentation</a></li><li class=""><a href="https://github.com/monix/monix-connect" target="_self">GitHub</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Documentation</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Documentation</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/overview">Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/akka">Akka Streams</a></li><li class="navListItem"><a class="navItem" href="/docs/parquet">Apache Parquet</a></li><li class="navListItem"><a class="navItem" href="/docs/dynamodb">AWS DynamoDB</a></li><li class="navListItem"><a class="navItem" href="/docs/s3">AWS S3</a></li><li class="navListItem"><a class="navItem" href="/docs/gcs">Google Cloud Storage</a></li><li class="navListItem"><a class="navItem" href="/docs/hdfs">HDFS</a></li><li class="navListItem"><a class="navItem" href="/docs/mongodb">MongoDB</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docs/redis">Redis</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 id="__docusaurus" class="postHeaderTitle">Redis</h1></header><article><div><span><h2><a class="anchor" aria-hidden="true" id="introduction"></a><a href="#introduction" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Introduction</h2>
<p><em>Redis</em> is an open source, in-memory data structure store, used as a database, cache and message broker providing high availability, scalability and a outstanding performance.
It supports data structures such as string, hashes, lists, sets, sorted sets with range queries, streams and more.
It has a defined a set of <a href="https://redis.io/commands">commands</a> to inter-operate with, and most of them are also available from the java api.</p>
<p>This connector has been built on top of <a href="https://lettuce.io/">lettuce</a>, the most popular java library for operating with a <em>non blocking</em> Redis client.</p>
<h2><a class="anchor" aria-hidden="true" id="dependency"></a><a href="#dependency" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Dependency</h2>
<p>Add the following dependency:</p>
<pre><code class="hljs css language-scala">libraryDependencies += <span class="hljs-string">"io.monix"</span> %% <span class="hljs-string">"monix-redis"</span> % <span class="hljs-string">"0.5.0"</span>
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="getting-started"></a><a href="#getting-started" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Getting started</h2>
<p>Redis provides a wide range of commands to perform a different range of operations, divided into 15 different groups.
Currently, this connector only  provides support for the most common used ones:  (<a href="https://redis.io/commands#generic">Keys</a>, <a href="https://redis.io/commands#hash">Hashes</a>, <a href="https://redis.io/commands#list">List</a>, <a href="https://redis.io/commands#pubsub">Pub/Sub</a>, <a href="https://redis.io/commands#server">Server</a>, <a href="https://redis.io/commands#set">Sets</a>, <a href="https://redis.io/commands#sorted_set">SortedSets</a>, <a href="https://redis.io/commands#stream">Streams</a> and <a href="https://redis.io/commands#string">Strings</a>).
Each of these modules has its own object located under <code>monix.connect.redis</code> package, being <code>Redis</code> the one that aggregates them all. But they can be individually used too.</p>
<p>Apart of that, you will only need to define an implicit instance of <code>StatefulRedisConnection[K, V]</code> in the scope of the .</p>
<p>On continuation let's show an example for each of the redis data group:</p>
<h3><a class="anchor" aria-hidden="true" id="__keys__"></a><a href="#__keys__" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>Keys</strong></h3>
<p>The following example uses the redis keys api <code>RedisKey</code> to show a little example on working with some basic key operations.</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">import</span> monix.connect.redis.<span class="hljs-type">RedisKey</span>

<span class="hljs-comment">//given two keys and a value</span>
<span class="hljs-keyword">val</span> key1: <span class="hljs-type">K</span> <span class="hljs-comment">// assuming that k1 initially exists</span>
<span class="hljs-keyword">val</span> key2: <span class="hljs-type">K</span> <span class="hljs-comment">// k2 does not exists</span>
<span class="hljs-keyword">val</span> value: <span class="hljs-type">String</span>

<span class="hljs-comment">//when</span>
<span class="hljs-keyword">val</span> t: <span class="hljs-type">Task</span>[<span class="hljs-type">Long</span>, <span class="hljs-type">Boolean</span>, <span class="hljs-type">Long</span>, <span class="hljs-type">Long</span>, <span class="hljs-type">Long</span>, <span class="hljs-type">Long</span>] = {
  <span class="hljs-keyword">for</span> {
    initialTtl &lt;- <span class="hljs-type">RedisKey</span>.ttl(key1)          <span class="hljs-comment">//checks the ttl when it hasn't been set yet</span>
    expire &lt;-  <span class="hljs-type">RedisKey</span>.expire(key1, <span class="hljs-number">5</span>)       <span class="hljs-comment">//sets the ttl to 5 seconds</span>
    finalTtl &lt;- <span class="hljs-type">RedisKey</span>.ttl(key1)            <span class="hljs-comment">//checks the ttl again</span>
    existsWithinTtl &lt;- <span class="hljs-type">RedisKey</span>.exists(key1)  <span class="hljs-comment">//checks whether k1 exists or not</span>
    _ &lt;- <span class="hljs-type">RedisKey</span>.rename(key1, key2)          <span class="hljs-comment">//renames k1 to k2</span>
    existsRenamed &lt;- <span class="hljs-type">RedisKey</span>.exists(key2)    <span class="hljs-comment">//checks that it exists after being renamed</span>
    _ &lt;- <span class="hljs-type">Task</span>.sleep(<span class="hljs-number">6.</span>seconds)
    existsAfterFiveSeconds &lt;- <span class="hljs-type">RedisKey</span>.exists(key2) <span class="hljs-comment">//after 6 seconds checks ttl again</span>
  } <span class="hljs-keyword">yield</span> (initialTtl, expire, finalTtl, existsWithinTtl, existsRenamed, existsAfterFiveSeconds)
}

<span class="hljs-comment">//then</span>
<span class="hljs-keyword">val</span> (initialTtl, expire, finalTtl, existsWithinTtl, existsRenamed, existsAfterFiveSeconds) = t.runSyncUnsafe()
initialTtl should be &lt; <span class="hljs-number">0</span>L
finalTtl should be &gt; <span class="hljs-number">0</span>L
expire shouldBe <span class="hljs-literal">true</span>
existsWithinTtl shouldBe <span class="hljs-number">1</span>L
existsRenamed shouldBe <span class="hljs-number">1</span>L
existsAfterFiveSeconds shouldBe <span class="hljs-number">0</span>L
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="__hashes__"></a><a href="#__hashes__" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>Hashes</strong></h3>
<p>The following example uses the redis hash api <code>RedisHash</code> to insert a single element into a hash and read it back from the hash.</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">import</span> monix.connect.redis.<span class="hljs-type">RedisHash</span>

<span class="hljs-keyword">val</span> key: <span class="hljs-type">String</span> = ???
<span class="hljs-keyword">val</span> field: <span class="hljs-type">String</span> = ???
<span class="hljs-keyword">val</span> value: <span class="hljs-type">String</span> = ???
 
<span class="hljs-keyword">val</span> t: <span class="hljs-type">Task</span>[<span class="hljs-type">String</span>] = <span class="hljs-keyword">for</span> {
    _ &lt;- <span class="hljs-type">RedisHash</span>.hset(key, field, value)
    v &lt;- <span class="hljs-type">RedisHash</span>.hget(key, field)
} <span class="hljs-keyword">yield</span> v
   
<span class="hljs-keyword">val</span> fv: <span class="hljs-type">Future</span>[<span class="hljs-type">String</span>] = t.runToFuture()
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="__lists__"></a><a href="#__lists__" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>Lists</strong></h3>
<p>The following example uses the redis list api <code>RedisList</code> to insert elements into a redis list and reading them back with limited size.</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">import</span> monix.connect.redis.<span class="hljs-type">RedisList</span>

<span class="hljs-keyword">val</span> key: <span class="hljs-type">String</span> = <span class="hljs-type">String</span>
<span class="hljs-keyword">val</span> values: <span class="hljs-type">List</span>[<span class="hljs-type">String</span>]
  
<span class="hljs-keyword">val</span> tl: <span class="hljs-type">Task</span>[<span class="hljs-type">List</span>[<span class="hljs-type">String</span>]] = <span class="hljs-keyword">for</span> {
  _ &lt;- <span class="hljs-type">RedisList</span>.lpush(key, values: _*)
  l &lt;- <span class="hljs-type">RedisList</span>.lrange(key, <span class="hljs-number">0</span>, values.size).toListL
} <span class="hljs-keyword">yield</span> l
  
<span class="hljs-comment">//a safer alternative to use that will return Observable[v] rather than Task[List[V]]</span>
<span class="hljs-keyword">val</span> ob: <span class="hljs-type">Observable</span>[<span class="hljs-type">String</span>] = <span class="hljs-keyword">for</span> {
  _ &lt;- <span class="hljs-type">Observable</span>.fromTask(<span class="hljs-type">RedisList</span>.lpush(key, values: _*))
  ob &lt;- <span class="hljs-type">RedisList</span>.lrange(key, <span class="hljs-number">0</span>, values.size)
} <span class="hljs-keyword">yield</span> ob
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="__pubsub__"></a><a href="#__pubsub__" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>Pub/Sub</strong></h3>
<p>Coming soon.</p>
<h3><a class="anchor" aria-hidden="true" id="__server__"></a><a href="#__server__" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>Server</strong></h3>
<p>The following code shows how to remove all keys from all dbs in redis using the server api <code>RedisServer</code> a very basic but also common use case:</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">import</span> monix.connect.redis.<span class="hljs-type">RedisServer</span>
 
<span class="hljs-keyword">val</span> t: <span class="hljs-type">Task</span>[<span class="hljs-type">String</span>] = <span class="hljs-type">RedisServer</span>.flushall() <span class="hljs-comment">//returns a simple string reply</span>
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="__sets__"></a><a href="#__sets__" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>Sets</strong></h3>
<p>The following code sample uses the redis sets api from <code>RedisSet</code> object, this one is a bit longer than the others but not more complex.</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">import</span> monix.connect.redis.<span class="hljs-type">RedisSet</span>

<span class="hljs-comment">//given three keys and two redis set of values</span>
<span class="hljs-keyword">val</span> k1: <span class="hljs-type">K</span> 
<span class="hljs-keyword">val</span> m1: <span class="hljs-type">Set</span>[<span class="hljs-type">String</span>]
<span class="hljs-keyword">val</span> k2: <span class="hljs-type">K</span> 
<span class="hljs-keyword">val</span> m2: <span class="hljs-type">Set</span>[<span class="hljs-type">String</span>]
<span class="hljs-keyword">val</span> k3: <span class="hljs-type">K</span>

<span class="hljs-comment">//when</span>
<span class="hljs-keyword">val</span> f1: <span class="hljs-type">Future</span>[(<span class="hljs-type">Long</span>, <span class="hljs-type">Long</span>, <span class="hljs-type">Boolean</span>)] = {
  <span class="hljs-keyword">for</span> {
    size1 &lt;- <span class="hljs-type">RedisSet</span>.sadd(k1, m1: _*) <span class="hljs-comment">//first list is added to the first hey</span>
    size2 &lt;- <span class="hljs-type">RedisSet</span>.sadd(k2, m2: _*) <span class="hljs-comment">//second list is added to second first key</span>
    _     &lt;- <span class="hljs-type">RedisSet</span>.sadd(k3, m1: _*) <span class="hljs-comment">//first list is added to the third key</span>
    moved &lt;- <span class="hljs-type">RedisSet</span>.smove(k1, k2, m1.head) <span class="hljs-comment">//moves the head member from the first set to the second one </span>
  } <span class="hljs-keyword">yield</span> { (size1, size2, moved) }
}.runToFuture() <span class="hljs-comment">//this is not safe and only</span>

<span class="hljs-comment">//and</span>
<span class="hljs-keyword">val</span> f2: <span class="hljs-type">Task</span>[(<span class="hljs-type">Long</span>, <span class="hljs-type">Long</span>, <span class="hljs-type">List</span>[<span class="hljs-type">String</span>], <span class="hljs-type">List</span>[<span class="hljs-type">String</span>])] = {
  <span class="hljs-keyword">for</span> {
    s1    &lt;- <span class="hljs-type">RedisSet</span>.smembers(k1).toListL <span class="hljs-comment">//get members form k1</span>
    s2    &lt;- <span class="hljs-type">RedisSet</span>.smembers(k2).toListL <span class="hljs-comment">//get members form k2</span>
    union &lt;- <span class="hljs-type">RedisSet</span>.sunion(k1, k2).toListL <span class="hljs-comment">//get members form k2 and k2</span>
    diff  &lt;- <span class="hljs-type">RedisSet</span>.sdiff(k3, k1).toListL <span class="hljs-comment">//get the diff members between k1 and k2</span>
  } <span class="hljs-keyword">yield</span> (s1, s2, union, diff)
}

<span class="hljs-comment">//then if the member's set did not existed before we can assume that:</span>
<span class="hljs-keyword">val</span> (size1, size2, moved) = f2.runSyncUnsafe()
<span class="hljs-keyword">val</span> (s1, s2, union, diff) = f2.runSyncUnsafe()
size1 shouldBe m1.size
s1.size shouldEqual (m1.size - <span class="hljs-number">1</span>)
size2 shouldBe m2.size
s2.size shouldEqual (m2.size + <span class="hljs-number">1</span>)
moved shouldBe <span class="hljs-literal">true</span>
s1 shouldNot contain theSameElementsAs m1
s2 shouldNot contain theSameElementsAs m2
union should contain theSameElementsAs m1 ++ m2
<span class="hljs-comment">//although the list are not equal as at the beginning because of the move operation, its union still is the same</span>
diff should contain theSameElementsAs <span class="hljs-type">List</span>(m1.head)
<span class="hljs-comment">//the difference between the k3 and k1 is equal to the element that was moved</span>
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="__sortedsets__"></a><a href="#__sortedsets__" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>SortedSets</strong></h3>
<p>The following example uses the redis sorted sets api from <code>RedisSortedSet</code> to insert three scored elements into a redis sorted set,
incrementing the middle one and then check that the scores are correctly reflected:</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">import</span> monix.connect.redis.<span class="hljs-type">RedisSortedSet</span>

<span class="hljs-comment">//given</span>
<span class="hljs-keyword">val</span> k: <span class="hljs-type">String</span> = <span class="hljs-string">"randomKey"</span>
<span class="hljs-keyword">val</span> v0: <span class="hljs-type">String</span> = <span class="hljs-string">"v0"</span>
<span class="hljs-keyword">val</span> v1: <span class="hljs-type">String</span> = <span class="hljs-string">"v1"</span>
<span class="hljs-keyword">val</span> v2: <span class="hljs-type">String</span> = <span class="hljs-string">"v2"</span>
<span class="hljs-keyword">val</span> minScore: <span class="hljs-type">Double</span> = <span class="hljs-number">1</span>
<span class="hljs-keyword">val</span> middleScore: <span class="hljs-type">Double</span> = <span class="hljs-number">3</span> 
<span class="hljs-keyword">val</span> maxScore: <span class="hljs-type">Double</span> = <span class="hljs-number">4</span>
<span class="hljs-keyword">val</span> increment: <span class="hljs-type">Double</span> = <span class="hljs-number">2</span>

<span class="hljs-comment">//when</span>
<span class="hljs-keyword">val</span> t: <span class="hljs-type">Task</span>[(<span class="hljs-type">ScoredValue</span>[<span class="hljs-type">String</span>], <span class="hljs-type">ScoredValue</span>[<span class="hljs-type">String</span>])] = <span class="hljs-keyword">for</span> {
  _ &lt;- <span class="hljs-type">RedisSortedSet</span>.zadd(k, minScore, v0)
  _ &lt;- <span class="hljs-type">RedisSortedSet</span>.zadd(k, middleScore, v1)
  _ &lt;- <span class="hljs-type">RedisSortedSet</span>.zadd(k, maxScore, v2)
  _ &lt;- <span class="hljs-type">RedisSortedSet</span>.zincrby(k, increment, v1) <span class="hljs-comment">//increments middle one by `increment` so it becomes the highest score of the set</span>
  min &lt;- <span class="hljs-type">RedisSortedSet</span>.zpopmin(k)
  max &lt;- <span class="hljs-type">RedisSortedSet</span>.zpopmax(k) 
} <span class="hljs-keyword">yield</span> (min, max)

<span class="hljs-comment">//then we can confirm that:</span>
<span class="hljs-keyword">val</span> (min, max) = t.runSyncUnsafe()
min.getScore shouldBe minScore
min.getValue shouldBe v0
max.getScore shouldBe middleScore + increment
max.getValue shouldBe v1
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="__streams__"></a><a href="#__streams__" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>Streams</strong></h3>
<p>Coming soon.</p>
<h3><a class="anchor" aria-hidden="true" id="__strings__"></a><a href="#__strings__" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>Strings</strong></h3>
<p>The following example uses the redis keys api from <code>RedisString</code> to insert a string into the given key and get its size from redis</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">import</span> monix.connect.redis.<span class="hljs-type">RedisString</span>

<span class="hljs-keyword">val</span> ts: <span class="hljs-type">Task</span>[<span class="hljs-type">Long</span>] = <span class="hljs-keyword">for</span> {
   _ &lt;- <span class="hljs-type">RedisString</span>.set(key, value).runSyncUnsafe()
   size &lt;- <span class="hljs-type">RedisString</span>.strlen(key)
  } <span class="hljs-keyword">yield</span> size
ts.runToFuture() <span class="hljs-comment">//eventually will return a failure if there was a redis server error, 0 if the key did not existed or the size of the string we put </span>
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="__all-in-one__"></a><a href="#__all-in-one__" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>All in one</strong></h3>
<p>See below a complete demonstration on how to compose a different set of redis commands from different
modules in the same for comprehension:</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">import</span> monix.connect.redis.<span class="hljs-type">Redis</span>
<span class="hljs-keyword">import</span> io.lettuce.core.<span class="hljs-type">RedisClient</span>
<span class="hljs-keyword">import</span> io.lettuce.core.api.<span class="hljs-type">StatefulRedisConnection</span>

<span class="hljs-keyword">val</span> redisClient: <span class="hljs-type">RedisClient</span> = <span class="hljs-type">RedisClient</span>.create(<span class="hljs-string">"redis://host:port"</span>)
<span class="hljs-keyword">implicit</span> <span class="hljs-keyword">val</span> connection: <span class="hljs-type">StatefulRedisConnection</span>[<span class="hljs-type">String</span>, <span class="hljs-type">String</span>] = redisClient.connect()
<span class="hljs-keyword">val</span> k1: <span class="hljs-type">K</span>
<span class="hljs-keyword">val</span> value: <span class="hljs-type">V</span>
<span class="hljs-keyword">val</span> k2: <span class="hljs-type">K</span>
<span class="hljs-keyword">val</span> values: <span class="hljs-type">List</span>[<span class="hljs-type">V</span>] 
<span class="hljs-keyword">val</span> k3: <span class="hljs-type">K</span>

<span class="hljs-keyword">val</span> t: <span class="hljs-type">Task</span>[<span class="hljs-type">String</span>, <span class="hljs-type">Long</span>, <span class="hljs-type">List</span>[<span class="hljs-type">V</span>], <span class="hljs-type">List</span>[<span class="hljs-type">K</span>]] = {
  <span class="hljs-keyword">for</span> {
    _ &lt;- <span class="hljs-type">Redis</span>.flushallAsync()            <span class="hljs-comment">//removes all keys</span>
    _ &lt;- <span class="hljs-type">Redis</span>.touch(k1)                  <span class="hljs-comment">//creates the `k1`</span>
    _ &lt;- <span class="hljs-type">Redis</span>.set(k1, value)             <span class="hljs-comment">//insert the single `value` to `k2`</span>
    _ &lt;- <span class="hljs-type">Redis</span>.rename(k1, k2)             <span class="hljs-comment">//rename `k1` to `k2`</span>
    _ &lt;- <span class="hljs-type">Redis</span>.lpush(k3, values: _*)      <span class="hljs-comment">//push all the elements of the list to `k3`</span>
    v &lt;- <span class="hljs-type">Redis</span>.get(k2)                    <span class="hljs-comment">//get the element in `k2`</span>
    _ &lt;- <span class="hljs-type">Redis</span>.lpushx(k3, v)              <span class="hljs-comment">//pre-append v to the list in `k3`</span>
    _ &lt;- <span class="hljs-type">Redis</span>.del(k2)                    <span class="hljs-comment">//delete key `k2`</span>
    len &lt;- <span class="hljs-type">Redis</span>.llen(k3)                 <span class="hljs-comment">//lenght of the list</span>
    l &lt;- <span class="hljs-type">Redis</span>.lrange(k3, <span class="hljs-number">0</span>, len).toListL <span class="hljs-comment">//this is not safe unless you have a reasonable limit</span>
    keys &lt;- <span class="hljs-type">Redis</span>.keys(<span class="hljs-string">"*"</span>).toListL       <span class="hljs-comment">//get all the keys</span>
  } <span class="hljs-keyword">yield</span> (v, len, l, keys)
}

<span class="hljs-comment">//after this comprehnsion of redis operations it can be confirmed that:</span>
<span class="hljs-keyword">val</span> (v: <span class="hljs-type">String</span>, len: <span class="hljs-type">Long</span>, l: <span class="hljs-type">List</span>[<span class="hljs-type">V</span>], keys: <span class="hljs-type">List</span>[<span class="hljs-type">K</span>]) = t.runSyncUnsafe() <span class="hljs-comment">// this is unsafe, and only used for testing purposes</span>
v shouldBe value
len shouldBe values.size + <span class="hljs-number">1</span>
l should contain theSameElementsAs value :: values
keys.size shouldBe <span class="hljs-number">1</span>
keys.head shouldBe k3
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="local-testing"></a><a href="#local-testing" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Local testing</h2>
<p>The local tests will use the <a href="https://hub.docker.com/_/redis/">redis docker image</a> from docker hub.</p>
<p>Add the following service description to your <code>docker-compose.yml</code> file:</p>
<pre><code class="hljs css language-yaml"> <span class="hljs-attr">redis:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">redis</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-number">6379</span><span class="hljs-string">:6379</span>
</code></pre>
<p>Run the following command to build and start the redis server:</p>
<pre><code class="hljs css language-shell script">docker-compose -f ./docker-compose.yml up -d redis
</code></pre>
<p>Check out that the service has started correctly.</p>
<p>Finally, following code shows how you can create the redis connection to the local server, but
you would have to modify that to fit your use case - i.e it will be different to connect to a redis cluster or if authenticating to the server is needed using with key and secret, etc.)</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">val</span> redisClient: <span class="hljs-type">RedisClient</span> = <span class="hljs-type">RedisClient</span>.create(<span class="hljs-string">"redis://host:port"</span>)
<span class="hljs-keyword">implicit</span> <span class="hljs-keyword">val</span> connection: <span class="hljs-type">StatefulRedisConnection</span>[<span class="hljs-type">String</span>, <span class="hljs-type">String</span>] = redisClient.connect()
</code></pre>
<p>And now you are ready to run your application!</p>
<p><em>Note that the above example defines the <code>connection</code> as <code>implicit</code>, since it is how the api will expect it.</em></p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/mongodb"><span class="arrow-prev">← </span><span class="function-name-prevnext">MongoDB</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#introduction">Introduction</a></li><li><a href="#dependency">Dependency</a></li><li><a href="#getting-started">Getting started</a><ul class="toc-headings"><li><a href="#__keys__"><strong>Keys</strong></a></li><li><a href="#__hashes__"><strong>Hashes</strong></a></li><li><a href="#__lists__"><strong>Lists</strong></a></li><li><a href="#__pubsub__"><strong>Pub/Sub</strong></a></li><li><a href="#__server__"><strong>Server</strong></a></li><li><a href="#__sets__"><strong>Sets</strong></a></li><li><a href="#__sortedsets__"><strong>SortedSets</strong></a></li><li><a href="#__streams__"><strong>Streams</strong></a></li><li><a href="#__strings__"><strong>Strings</strong></a></li><li><a href="#__all-in-one__"><strong>All in one</strong></a></li></ul></li><li><a href="#local-testing">Local testing</a></li></ul></nav></div><footer class="nav-footer" id="footer"><hr class="separator"/><section class="copyright">Copyright © 2020-2020 The Monix Connect Developers.</section></footer></div></body></html>